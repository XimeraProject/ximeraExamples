\usepackage{lipsum}
\usepackage{caption}  % optional, better caption formatting (eg in labels.tex)


% references: Ximera heeft adhoc logica	 om online labels te doen werken over verschillende files heen
\ifdefined\HCode
% Link to standard \labels, but give your own description
% Usage:  Volg \hyperref[my_very_verbose_label]{deze link} voor wat tijdverlies
%   (01/2020: Ximera-server aangepast om bij class reference-keeptext de link-text NIET te vervangen door de label-text !!!) 
%
%  Link to specific targets  (not tested ?)
\renewcommand{\hypertarget}[1]  {\HCode{<a class="ximera-label" id="#1"></a>}}
\renewcommand{\hyperlink  }[2]  {\HCode{<a class="reference reference-keeptext" href="\##1">}#2\HCode{</a>}}
% \hyperref links to a label, but with an optional custom text
\renewcommand{\hyperref   }[2][]{\HCode{<a class="reference reference-keeptext" href="\##1">}#2\HCode{</a>}}
\fi


\usepackage{xparse}
\usepackage{hyperref}
\usepackage{etoolbox}
\usepackage{xstring}

\ExplSyntaxOn


\cs_generate_variant:Nn \regex_match:nnTF {nV}

\NewDocumentCommand \ifIsUrl { m m m }
  {
    % 1) grab & fully expand the input into a temp token list
    \str_set:Nx \l_tmpa_str { #1 }
    % 2) do the regex‐match on that fully expanded string
    \regex_match:nVTF
      { ^(?:http|\./|\.\./).* }    % pattern: start→http OR ./ OR ../    
      { \l_tmpa_str }
      { \IfValueTF{#2}{#2}{#3} }   % true branch (optional true‐code)
      { #3 }                       % false branch
  }

\ExplSyntaxOff


% % Define a function that tests the three prefixes in one regex
% \cs_new:Npn \check_prefix:nTF #1#2#3 {
%   \regex_match:nnTF { ^(?:http|\./|\.\.\/) } % <-- match http or ./ or ../ at start
%     {#1}  % string to match
%     {#2}  % true branch
%     {#3}  % false branch
% }

% % A user‐level wrapper
% \NewDocumentCommand \ifIsUrl { m m m } {
%   \check_prefix:nTF { #1 } { #2 } { #3 }
% }

\ExplSyntaxOff

% Define the \xmref command
\NewDocumentCommand{\xmref}{O{} m}{%
  \begingroup
  \edef\textarg{#1}%
  \edef\keyarg{#2}%
  % Decide what to do based on textarg and prefix
  \if\relax\detokenize{#1}\relax
    % No [tekst] given → \ref{key}
    \ifIsUrl{\keyarg}{%
        URL \url{#2}%
      }{%
        REF \ref{#2}%
      }
  \else
    \ifIsUrl{\keyarg}{%
      HREF \href{\keyarg}{\textarg}%
    }{%
      HYPR \hyperref[\keyarg]{\textarg}%
    }%
  \fi
  \endgroup
}



% \ExplSyntaxOn

% % Main command: optional [tekst], required {key}
% \NewDocumentCommand{\xmrefB}{O{} +m}
%   {
%     \xmref_command:nn { #1 } { #2 }
%   }

% \cs_new_protected:Nn \xmref_command:nn
%   {
%     \tl_set:Nn \l_tmpa_tl { #1 } % tekst
%     \tl_set:Nn \l_tmpb_tl { #2 } % key (can contain underscores)

%     \tl_if_blank:VTF \l_tmpa_tl
%       {
%         % No tekst → fallback to \ref
%         \ref{ \l_tmpb_tl }
%       }
%       {
%         % Tekst is given → check if key is a URL
%         \tl_if_in:VnTF \l_tmpb_tl { http:// }
%           { \href{ \l_tmpb_tl }{ \l_tmpa_tl } }
%           {
%             \tl_if_in:VnTF \l_tmpb_tl { https:// }
%               { \href{ \l_tmpb_tl }{ \l_tmpa_tl } }
%               {
%                 \tl_if_in:VnTF \l_tmpb_tl { ./ }
%                   { \href{ \l_tmpb_tl }{ \l_tmpa_tl } }
%                   {
%                     % Not a URL → assume internal label
%                     \hyperref[ \l_tmpb_tl ]{ \l_tmpa_tl }
%                   }
%               }
%           }
%       }
%   }

% \ExplSyntaxOff



% \ExplSyntaxOn

% \NewDocumentCommand{\xmrefA}{O{}m}
%   {
%     \xmref_command:nn { #1 } { #2 }
%   }

% \cs_new_protected:Nn \xmref_command:nn
%   {
%     \tl_set:Nn \l_tmpa_tl { #1 } % tekst
%     \tl_set:Nn \l_tmpb_tl { #2 } % key

%     \tl_if_blank:VTF \l_tmpa_tl
%       {
%         % No tekst → fallback to \ref
%         \ref{ \l_tmpb_tl }
%       }
%       {
%         % Tekst is given → check if key is a URL
%         \tl_if_in:VnTF \l_tmpb_tl { http:// }
%           { \href{ \l_tmpb_tl }{ \l_tmpa_tl } }
%           {
%             \tl_if_in:VnTF \l_tmpb_tl { https:// }
%               { \href{ \l_tmpb_tl }{ \l_tmpa_tl } }
%               {
%                 \tl_if_in:VnTF \l_tmpb_tl { ./ }
%                   { \href{ \l_tmpb_tl }{ \l_tmpa_tl } }
%                   {
%                     % Not a URL → assume internal label
%                     \hyperref[ \l_tmpb_tl ]{ \l_tmpa_tl }
%                   }
%               }
%           }
%       }
%   }

% \ExplSyntaxOff
